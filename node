extends Node
var hunger = 100
var happy = 100

@export var point1: Vector2 = Vector2(510, 169)
@export var point2: Vector2 = Vector2(638, 300)
@export var food_numnum: Resource = preload("res://food.tscn")

var run: bool = true

func get_random_point_inside(p1: Vector2, p2: Vector2) -> Vector2:

	var xvalue: float = randf_range(p1.x, p2.x)
	var yvalue: float = randf_range(p1.y, p2.y)
	
	var randompointinside: Vector2 = Vector2 (xvalue, yvalue)
	
	return randompointinside


func spawn():
	var food_instance: Node = food_numnum.instantiate()
	add_child(food_instance)
	var spawn_location: Vector2 = get_random_point_inside(point1, point2)
	food_instance.set_position(spawn_location)
	if !Globals.showDirt:
		for dirt in get_tree().get_nodes_in_group("dirt"):
			dirt.hide()
	else:
		for dirt in get_tree().get_nodes_in_group("dirt"):
			dirt.show()
	
	#await get_tree().create_timer(0.2).timeout
	#food_instance.queue_free()
	

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	pass
	
func end_game():
	run = false

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	if (run == true):
		if (hunger == 0):
			end_game()
	


func _on_timer_timeout() -> void:
	if (run == true):
		hunger = clamp(hunger, 0, 100)
		hunger -= 1
		$FeedScene/HungerBar.value = hunger





func feed():
	if Globals.food > 0:
		hunger = clamp(hunger, 0, 100)
		hunger += 10
		Globals.food -= 1
		$FoodCounter.text = (str(Globals.food)) + " Food"

		$FeedScene/HungerBar .value = hunger
	
func play():
	happy = (int)(clamp(happy, 0, 100))
	happy += 10

	$FeedScene/HappyBar.value = happy
	


func _on_button_pressed() -> void:

	if (run == true):
		feed()
		


func _on_happy_timer_timeout() -> void:
	if (run == true):
		happy = clamp(happy, 0, 100)
		happy -= 1
		$FeedScene/HappyBar.value = happy

func _on_play_button_pressed() -> void:
	if (run == true):
		play()



func _on_buy_food_pressed() -> void:
	if Globals.money >= 10:
		Globals.food = Globals.food + 1
		Globals.money = Globals.money - 10
		$MoneyCounter.text = str(Globals.money) + " dollars"
		$FoodCounter.text = (str(Globals.food)) + " Food"
	


func _on_dirty_timer_timeout() -> void:
	spawn()
